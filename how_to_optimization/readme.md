# WEBサイトの高速化・最適化

## 目次

## はじめに

個人的な話になりますが、自分がWEBサイトやWEBアプリケーションで一番重視するのはユーザビリティー(使いやすさ)です。  
使いやすいかどうかの一番の決め手は、表示速度です。

**WEBサイトのロード時間が長くなるなればなるほど、ユーザーの離脱に繋がる。**

参考：https://royal.pingdom.com/page-load-time-really-affect-bounce-rate/

記事によると、ページのロード時間が2秒以内の場合は、ユーザーの離脱率は8%程度だが5、秒になると4割近く離脱してしまう。


## CSS/JS処理

- ファイルの縮小化
- ファイルの統合

### ファイルの縮小化

テキスト内の空白やタブ文字などを取り払う。開発時は読みやすくするために改行などを行うが、アップロード用のファイルではそういったものを全て取り除く。
gulpの場合、下記プラグインで対応できる。

|プラグイン名|用途|
|---|:---|
|[gulp-uglify](https://www.npmjs.com/package/gulp-uglify)|JSを縮小化することができる。|
|[gulp-clean-css](https://www.npmjs.com/package/gulp-clean-css)|CSSを縮小化することができる。|

### ファイルの統合

JSファイルやCSSファイルをできるかぎり纏めることによって、読み込むファイルの数を減らし、ロード時間の短縮化につなげる。

|プラグイン名|用途|
|---|:---|
|[gulp-concat](https://www.npmjs.com/package/gulp-concat)|ファイルを纏めることができる。|

またwebpackを使えば、CSSとJSファイルもひとまとめにすることができる。

## 画像処理

WEBサイトで転送されるデータファイルの大部分を占めるので、ここで適切な対策ができるかどうかが重要となる。

- 画像拡張子
- CSSスプライトの使用
- 画像の軽量化


### 適切な画像の拡張子を選ぶ

|拡張子|概要|
|---|:---|
|png|圧縮処理で画像が視覚的に変化することはない。透明度設定が可能なので、基本的にはどのような画像にも使えますが、JPEGよりもファイルサイズが大きくなりがち。アイコンやテキスト画像などに向いている。|
|jpeg|pngやgitと比較して圧縮処理することで大幅に容量を抑えることが可能。圧縮するたびに画像が劣化する。透明度を設定することができない。写真などに向いている。|
|svg|拡大・縮小しても荒れて表示されない。テキストエディタで編集することができる。ロゴや線画に向いている。|
|webp|googleが推奨している拡張子。jpegやpngに比べてファイル要領を大幅に削ることができるが、現在SafariとIEでは使えない。|


### CSSスプライトの使用

複数の画像を一つの画像にまとめること。
複数の画像を一つにまとめることで、読み込むファイル数が減って全体のロード時間を抑えることができる。

https://static.xx.fbcdn.net/rsrc.php/v3/yR/r/jKTwnGFdeVL.png
(Facebookが使っているスプライト画像)

gulpでは、[gulp.spritesmith](https://www.npmjs.com/package/gulp.spritesmith)を使ってsprite画像を作ることができる。

### 画像の軽量化


## ページのロード時間の確認方法

- chromeのデベロッパーツールを使う。
- [PageSpeed Insights](https://developers.google.com/speed/pagespeed/insights/)を使う。

### chromeのデベロッパーツールを使う。

主に下記のようなことができる。

- 通信速度を変えることができる。
- キャッシュを無効にすることで、最初にページを訪れたときにどのように見えるかを確認することができる。
- 必要なファイルを読み込むのにかかった時間や、ページが表示されるまでにかかった時間を調べることができる。

### PageSpeed Insightsを使う。

ロード時間を短くするためにどういったことができるかを調べることができる。



### 書籍・URL

- WEBサイトパフォーマンス実践入門 高速なWebページを作りたいあなたに (翔泳社 (2018/3/19))
- Webフロントエンド ハイパフォーマンス チューニング (技術評論社 (2017/5/26))